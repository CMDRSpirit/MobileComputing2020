<html>
<head>
	<link rel="stylesheet" type="text/css" href="./style/common.css">

	<title>Virtual GPS Based World Renderer</title>
</head>

<body>
	<div class="flex_body">
		<div class="horizontalLine"></div>
		
		<div class="HeaderBar">
		<div class="HeaderButton" id="btn_start">Start</div>		
		<div class="HeaderButton" id="btn_stop">Stop</div>		
		</div>
		
		<div class="horizontalLine"></div>
		
		<canvas id="gl_win"></canvas>
		
		<div class="horizontalLine"></div>

		<div id="Debug">Debug</div>

		<div class="horizontalLine"></div>

	</div>
</body>

<!-- Shader definition -->
<script id="shader_vs" type="notjs">
attribute vec2 vertex;

varying vec2 texCoords;

void main(){
	gl_Position = vec4(vertex, 0.0, 1.0);

	texCoords = vertex.xy * 0.5 + 0.5;
}
</script>
<script id="shader_fs" type="notjs">
precision mediump float;

varying vec2 texCoords;

uniform mat4 invVP;

#define MAX_SAMPLES 16
#define EPSILON 0.01

//SDF Intersection functions by iq https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm
float sdRoundBox( vec3 p, vec3 b, float r )
{
  vec3 q = abs(p) - b;
  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0) - r;
}
//-------------------------

float calcDist(vec3 p){
	return sdRoundBox(vec3(0.0, -1.0, -1.0) - p, vec3(0.1, 0.1, 0.1), 0.1);
}

vec3 raymarch(vec3 ro, vec3 rd){
	vec3 p = ro;
	float dist = calcDist(p);

	for(int i=0; i<MAX_SAMPLES; ++i){
		p += rd * dist;

		dist = calcDist(p);
		if(dist < EPSILON){
			return vec3(1.0);
		}
	}

	return vec3(0.0, 0.5, 1.0);
}

void main(){
	vec2 uc = 2.0 * texCoords - 1.0;

	vec3 ro = vec3(0.0);
	vec3 rd = (invVP * vec4(normalize(vec3(uc, -1.0)), 1.0)).xyz;
	//rd = vec3(-rd.x, -rd.z, -rd.y);

	vec3 color = raymarch(ro, rd);

	gl_FragColor = vec4(color, 1.0);
}
</script>
<!--------------------- -->

<script src="./script/main.js"></script>

</html>